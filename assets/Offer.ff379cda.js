import{b as Q,e as W,h as P,z as X,c as v,ac as Z,G as g,E as ee,H as ae,r as se,d as l,a as te,w as A,I as ne,v as p,J as $,T as oe,u as n,k as N,L as ie,i as s,t as d,j as ce,f as m,p as re,q as le,M as de,P as B,N as ue,o as i,n as S,S as M}from"./gpb-new.9481ec94.js";import{u as pe,_ as _e,a as ve,b as me,D as fe,U as he,V as be,c as ye,d as ge,M as Se}from"./FormHeader.8e911390.js";import{_ as Te}from"./angle-right_blue.3c01ebe8.js";import{D as Ce,a as De}from"./Dialog.55d98c8a.js";import{u as ke}from"./usePaymentAvailability.27b8d1fe.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./useLoader.013ecf08.js";const Ie=s("div",{id:"acs"},null,-1),Ee={key:0,class:"content-wrapper offer"},we={key:0,class:"main-form__title-Saved-Card"},Ve={class:"pan-input-container"},Pe={class:"input pan-offer"},Ae={class:"input__group"},$e={for:"pan"},Ne=s("input",{id:"pan",name:"pan",type:"password",disabled:"true",value:""},null,-1),Be={class:"pan-value"},Me={class:"icons-container"},Ue={class:"card-brand"},He=["src"],Fe=s("div",{class:"cvc-logo"},[s("img",{src:me,alt:"CVC"})],-1),Oe={key:1,class:"checkbox-container"},Re={class:"pay-btn-container"},Le=["disabled"],qe={key:1,class:"content-wrapper offer"},ze={class:"treeDS-info"},je={class:"treeDS-info__title"},Ge={class:"treeDS-info__description"},Ye={class:"content-wrapper"},xe={class:"back-to-merchant-container"},Je=s("img",{class:"angle-right",src:Te},null,-1),ta={setup(Ke){const{checkPaymentState:T,paymentState:a,timeoutApiErrorHandlerCb:U}=Q(),{state:H,accept:F,decline:O}=re(),u=W(),{card:o}=pe(),f=P(!1),{iframeHandler:R,apiErrorHandlerOn:L,apiErrorHandlerOff:q}=X(),{requestProcessing:C,globalLoaderShow:z,globalLoaderHide:D}=le(),h=P(!1),j=v(()=>`\u2022 \u2022 \u2022 \u2022  ${(a.value.dst?a.value.dst.pan:a.value.src.pan).substr(-4)}`),G=v(()=>{const e=a.value.dst?a.value.dst.pan:a.value.src.pan;return de(e,{UPI:he,VISA:be,MASTERCARD:ye,MAESTRO:ge,MIR:Se},fe)}),k=v(()=>a.value.paymentId===B.OCT?"transferToCard":a.value.paymentId===B.AFT?"transferToAccount":"pay"),Y=v(()=>!o.cvc||o.cvc.length<=ue.CVC);function b(){var t,c;let e=!1;return((t=a.value.options)==null?void 0:t.srcChangeDisabled)&&a.value.src.type!==M.gazprom_pay||u.query.paymentId&&u.query.paymentId==="oct"?e=!1:e=!((c=a.value.options)!=null&&c.srcCscDisabled),e}function x(){var e,t;return((e=a.value.src)==null?void 0:e.type)===M.gazprom_pay&&((t=a.value.src)==null?void 0:t.addToProfileEnabled)}async function J(){var _,r;C(),z(),h.value=!0;const e=u.hash.slice(1),t={};b()&&(t["src.csc"]=o.cvc),o.save&&(t["src.addToProfile"]=!0),(r=(_=a.value)==null?void 0:_.options)!=null&&r.customerReceiptAreaEnabled&&Object.assign(t,{"customer.receiptUrl":location.origin+"/"+window.location.hash});const c=await F(e,t);await T(c,e),c.state===g.RESULT&&D()}async function K(){C();const e=u.hash.slice(1);try{await O(e)}catch(t){console.log(t)}finally{location.href=u.query.back_url_f}}return Z(()=>{if(a.value.state===g["3DS2INFO"]){h.value=!1,D();const e=u.hash.slice(1);setTimeout(async()=>{const t=await H(e);await T(t,e)},3e4)}}),ee(async()=>{R(f),L(U),await ke(a)}),ae(()=>q()),(e,t)=>{const c=se("focus-next");return i(),l(N,null,[(i(),te(oe,{to:"body"},[A(p(Ce,null,{default:$(()=>[Ie]),_:1},512),[[ne,f.value]])])),n(a)&&!h.value&&!f.value?(i(),l(N,{key:0},[n(a).state!==n(g)["3DS2INFO"]?(i(),l("div",Ee,[p(_e,{data:n(a)},null,8,["data"]),p(n(ie),{class:"main-form",onSubmit:J},{default:$(({isSubmitting:_,errors:r})=>{var I,E,w,V;return[((E=(I=n(a))==null?void 0:I.src)==null?void 0:E.cardId)||((V=(w=n(a))==null?void 0:w.dst)==null?void 0:V.cardId)?(i(),l("div",we,d(e.$t(`pages.offer.titleSavedCard.${n(k)}`)),1)):m("",!0),s("div",{class:S(["pan-cvc-input-container",{invalid:r.cvc}])},[s("div",Ve,[s("div",Pe,[s("div",Ae,[s("label",$e,d(e.$t("ui.input.pan.label")),1),Ne,s("span",Be,d(n(j)),1)])]),s("div",Me,[s("div",Ue,[s("img",{src:n(G),alt:"Brand"},null,8,He)])])]),b()?(i(),l("div",{key:0,class:S(["cvc-input-group",{invalid:r.cvc}])},[A(p(ve,{modelValue:n(o).cvc,"onUpdate:modelValue":t[0]||(t[0]=y=>n(o).cvc=y),errors:r,class:S({"none-empty-input":n(o).cvc})},null,8,["modelValue","errors","class"]),[[c,{length:3,target:"addToProfile"}]]),Fe],2)):m("",!0)],2),x()?(i(),l("div",Oe,[p(De,{modelValue:n(o).save,"onUpdate:modelValue":t[1]||(t[1]=y=>n(o).save=y),name:"addToProfile",class:"addToProfile",label:e.$t("ui.input.saveCard.label")},null,8,["modelValue","label"])])):m("",!0),s("div",Re,[s("button",{id:"submitBtn",type:"submit",disabled:_||Object.keys(r).length||b()&&n(Y),class:"btn btn-primary"},d(e.$t(`ui.btn.${n(k)}`)),9,Le)])]}),_:1})])):(i(),l("div",qe,[s("div",ze,[s("div",je,d(e.$t("pages.offer.titleTreeDSInfo")),1),s("div",Ge,d(n(a).cardholderInfo),1)])])),s("div",Ye,[s("div",xe,[s("button",{class:"btn back-to-merchant",onClick:K},[ce(d(e.$t("ui.btn.goToMerchant"))+" ",1),Je])])])],64)):m("",!0)],64)}}};export{ta as default};
