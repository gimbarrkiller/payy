import{h as W,j as X,m as B,I as Z,c as u,a0 as ee,q as se,s as ae,r as te,b as p,a as A,w as N,K as ne,B as m,L as O,T as oe,u as t,z as R,J as g,af as ce,e as a,t as d,v as ie,d as v,i as re,O as le,P as S,Q as de,g as ue,o as r,n as f,k as pe,S as _e}from"./gpb-fns.1cc41912.js";import{u as me,_ as ve,a as fe,V as be,M as he,b as ye,c as ge,U as Se}from"./MASTERCARD.e366ccdc.js";import{_ as Te}from"./angle-right_blue.3c01ebe8.js";import{u as Ce}from"./usePaymentAvailability.299ea4fd.js";import{D as ke,a as De}from"./Checkbox.2b9c2cae.js";import{_ as Ie}from"./FormHeader.277ef804.js";import"./useLoader.c46ce039.js";import"./plugin-vue_export-helper.21dcd24c.js";const Ve=a("div",{id:"acs"},null,-1),Ee={key:0,class:"content-wrapper offer"},Pe={key:0,class:"main-form__title-Saved-Card"},we={class:"pan-input-container"},$e={class:"input pan-offer"},Be={class:"input__group"},Ae={for:"pan"},Ne=a("input",{id:"pan",name:"pan",type:"password",disabled:"true",value:""},null,-1),Oe={class:"pan-value"},Re={class:"icons-container"},Me={class:"card-brand"},Ue=["src"],He=a("div",{class:"cvc-logo"},[a("img",{src:fe,alt:"CVC"})],-1),Fe={class:"pay-btn-container"},qe=["disabled"],Le={key:1,class:"content-wrapper offer"},je={class:"treeDS-info"},ze={class:"treeDS-info__title"},xe={class:"treeDS-info__description"},Ye={class:"content-wrapper"},Ge={class:"back-to-merchant-container"},Je=a("img",{class:"angle-right",src:Te},null,-1),ns={setup(Ke){const{checkPaymentState:T,paymentState:s,timeoutApiErrorHandlerCb:M}=W(),{state:U,accept:H,decline:F}=pe(),o=X(),{card:c}=me(),b=B(!1),{iframeHandler:q,apiErrorHandlerOn:L,apiErrorHandlerOff:j}=Z(),{requestProcessing:C,globalLoaderShow:k,globalLoaderHide:D}=re(),I=B(!1),z=u(()=>`\u2022 \u2022 \u2022 \u2022  ${(s.value.dst?s.value.dst.pan:s.value.src.pan).substr(-4)}`),x=u(()=>{const e=s.value.dst?s.value.dst.pan:s.value.src.pan;return le(e,{VISA:be,MIR:he,MASTERCARD:ye,MAESTRO:ge,UPI:Se})}),V=u(()=>s.value.paymentId===S.OCT?"transferToCard":"pay");function h(){var n,i;let e=!1;return((n=s.value.options)==null?void 0:n.srcChangeDisabled)&&s.value.src.type!==_e.gazprom_pay||o.query.paymentId&&o.query.paymentId===S.OCT?e=!1:e=!((i=s.value.options)!=null&&i.srcCscDisabled),e}const Y=u(()=>{var e;return(!s.value.paymentId||s.value.paymentId===S.TRANSP_DEBT)&&((e=s.value.src)==null?void 0:e.addToProfileEnabled)}),G=u(()=>!c.cvc||c.cvc.length<=de.CVC),J=u(()=>s.value&&!I.value&&!b.value);async function K(){C();const e=o.hash.slice(1);try{await F(e)}catch(n){console.log(n)}finally{location.href=o.query.back_url_f}}async function Q(){var _;C(),k(),I.value=!0;const e=o.hash.slice(1),n={};if(h()&&(n["src.csc"]=c.cvc),c.save&&(n["src.addToProfile"]=!0),(_=s.value.options)!=null&&_.customerReceiptAreaEnabled){const{back_url_s:l}=o.query;Object.assign(n,{"customer.receiptUrl":ue(o==null?void 0:o.name,{back_url_s:l})})}const i=await H(e,n);await T(i,e),i.state===g.RESULT&&D()}return ee(()=>s.value,e=>{if(e.state===g["3DS2INFO"]){D();const n=o.hash.slice(1);setTimeout(async()=>{k();const i=await U(n);await T(i,n)},3e4)}},{deep:!0}),se(()=>{q(b),L(M),Ce(s)}),ae(()=>j()),(e,n)=>{const i=te("focus-next");return r(),p(R,null,[(r(),A(oe,{to:"body"},[N(m(ke,null,{default:O(()=>[Ve]),_:1},512),[[ne,b.value]])])),t(J)?(r(),p(R,{key:0},[t(s).state!==t(g)["3DS2INFO"]?(r(),p("div",Ee,[m(Ie,{data:t(s)},null,8,["data"]),m(t(ce),{class:"main-form",onSubmit:Q},{default:O(({isSubmitting:_,errors:l})=>{var E,P,w,$;return[((P=(E=t(s))==null?void 0:E.src)==null?void 0:P.cardId)||(($=(w=t(s))==null?void 0:w.dst)==null?void 0:$.cardId)?(r(),p("div",Pe,d(e.$t(`pages.offer.titleSavedCard.${t(V)}`)),1)):v("",!0),a("div",{class:f(["pan-cvc-input-container",{invalid:l.cvc}])},[a("div",we,[a("div",$e,[a("div",Be,[a("label",Ae,d(e.$t("ui.input.pan.label")),1),Ne,a("span",Oe,d(t(z)),1)])]),a("div",Re,[a("div",Me,[a("img",{src:t(x),alt:"Brand"},null,8,Ue)])])]),h()?(r(),p("div",{key:0,class:f(["cvc-input-group",{invalid:l.cvc}])},[N(m(ve,{modelValue:t(c).cvc,"onUpdate:modelValue":n[0]||(n[0]=y=>t(c).cvc=y),errors:l,class:f({"none-empty-input":t(c).cvc})},null,8,["modelValue","errors","class"]),[[i,{length:3,target:"addToProfile"}]]),He],2)):v("",!0)],2),t(Y)?(r(),A(De,{key:1,modelValue:t(c).save,"onUpdate:modelValue":n[1]||(n[1]=y=>t(c).save=y),name:"addToProfile",class:f(["addToProfile checkbox-container",{invalid:l.cvc}]),label:e.$t("ui.input.saveCard.label")},null,8,["modelValue","class","label"])):v("",!0),a("div",Fe,[a("button",{id:"submitBtn",type:"submit",disabled:_||Object.keys(l).length||h()&&t(G),class:"btn btn-primary"},d(e.$t(`ui.btn.${t(V)}`)),9,qe)])]}),_:1})])):(r(),p("div",Le,[a("div",je,[a("div",ze,d(e.$t("pages.offer.titleTreeDSInfo")),1),a("div",xe,d(t(s).cardholderInfo),1)])])),a("div",Ye,[a("div",Ge,[a("button",{class:"btn back-to-merchant",onClick:K},[ie(d(e.$t("ui.btn.goToMerchant"))+" ",1),Je])])])],64)):v("",!0)],64)}}};export{ns as default};
