import{_ as be}from"./angle-right_blue.3c01ebe8.js";import{o as s,b as n,ad as ee,y as Q,E as Z,a as D,L as h,e,t as l,C as x,u as r,z as O,l as oe,B as y,n as k,v as X,j as se,k as ce,m as z,c as U,r as ge,d as v,aj as ie,T as fe,w as he,ac as $e,af as re,g as ye,F as Y,ak as N,I as ke,h as Ae,q as Re,s as Ve,i as Se}from"./gpb-fns.1cc41912.js";import{D as ne,a as te,_ as ae}from"./Checkbox.2b9c2cae.js";import{_ as ue}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as Ce}from"./gazprombank_ru.80efb3f5.js";import{c as Te}from"./config.4dc2f738.js";import{u as Ee}from"./usePaymentAvailability.299ea4fd.js";import"./useLoader.c46ce039.js";var we="assets/receiptSuccess.30f6166a.svg";const Ie={};function De(d,i){return s(),n("div",{class:"modal",onClick:i[0]||(i[0]=Q(()=>{},["stop"]))},[ee(d.$slots,"header"),ee(d.$slots,"body"),ee(d.$slots,"footer")])}var de=ue(Ie,[["render",De]]);const Ue={class:"modal-header"},Oe={class:"modal-header__title"},je={class:"modal-content"},Me={class:"modal-content__description"},Be={class:"modal-content__list"},qe={class:"button-container"},xe={props:{modelValue:{type:Boolean}},emits:["update:modelValue","accept"],setup(d,{emit:i}){const{tm:u}=Z(),t=u("receiptArea.agree_modal_content.description.personal_data_list"),C=u("receiptArea.agree_modal_content.description.agreements_text");function b(){i("accept"),i("update:modelValue",!1)}function a(){i("reject"),i("update:modelValue",!1)}return(_,A)=>(s(),D(de,{class:"agreement"},{header:h(()=>[e("header",Ue,[e("h2",Oe,l(_.$t("receiptArea.agree_modal_content.title")),1)])]),body:h(()=>[e("div",je,[e("p",Me,l(_.$t("receiptArea.agree_modal_content.description.personal_data_list_title")),1),e("ul",Be,[(s(!0),n(O,null,x(r(t),p=>(s(),n("li",{key:p,class:"modal-content__description"},l(p),1))),128))]),(s(!0),n(O,null,x(r(C),p=>(s(),n("p",{key:p,class:"modal-content__description"},l(p),1))),128))])]),footer:h(()=>[e("div",qe,[e("button",{class:"btn btn-primary",onClick:b},l(_.$t("ui.btn.accept")),1),e("button",{class:"btn btn-reject",onClick:a},l(_.$t("ui.btn.reject")),1)])]),_:1}))}};var pe="assets/stamp.614410de.svg";const Pe={},Le={class:"receipt-example__footer"},Fe={href:"https://www.gazprombank.ru/feedback",target:"_blank"};function He(d,i){const u=oe("i18n-t");return s(),n("footer",Le,[y(u,{keypath:"receiptArea.receipt_example_content.footer_description.text",tag:"p"},{default:h(()=>[e("a",Fe,l(d.$t("receiptArea.receipt_example_content.footer_description.link")),1)]),_:1}),e("p",null,l(d.$t("receiptArea.receipt_example_content.footer_description.mobile_operator")),1),e("p",null,l(d.$t("receiptArea.receipt_example_content.footer_description.city_phone")),1)])}var _e=ue(Pe,[["render",He]]);const Ne={class:"receipt-example__header"},ze=e("img",{class:"bank-logo",src:Ce,alt:"Bank logo"},null,-1),We={class:"receipt-example__info"},Ge={class:"receipt-example__content"},Ye={class:"caption"},Je={class:"table-header"},Ke={class:"table-body"},Qe={class:"title"},Xe={class:"text"},Ze={class:"detailed-container"},et={class:"detailed-description__title"},tt={class:"detailed-description__amount"},at=e("div",{class:"stamp-container"},[e("img",{src:pe})],-1),st={setup(d){const{tm:i}=Z(),u=i("receiptArea.receipt_example_content.table");return(t,C)=>(s(),D(de,{class:"receipt-example"},{header:h(()=>[e("header",Ne,[e("div",{class:"close-icon",onClick:C[0]||(C[0]=b=>t.$emit("update:modelValue",!1))}),ze,e("div",We,l(t.$t("receiptArea.receipt_example_content.info")),1)])]),body:h(()=>[e("div",Ge,[e("p",Ye,l(t.$t("receiptArea.receipt_example_content.caption")),1),e("h2",Je,l(t.$t("receiptArea.receipt_example_content.table_header")),1),e("table",Ke,[(s(!0),n(O,null,x(r(u),b=>(s(),n("tr",{key:b.key,class:k(b.class)},[e("td",Qe,l(b.key),1),e("td",Xe,l(b.value),1)],2))),128))]),e("div",Ze,[(s(),n(O,null,x(3,b=>e("div",{key:b,class:"detailed-description"},[e("p",et,l(t.$t("receiptArea.receipt_example_content.detailed_description.title")),1),e("p",tt,[X(l(t.$t("receiptArea.receipt_example_content.detailed_description.amount"))+" ",1),e("span",null,l(t.$t("receiptArea.receipt_example_content.detailed_description.value")),1)])])),64))]),at])]),footer:h(()=>[y(_e)]),_:1}))}},lt={class:"receiptResult__btns"},me={setup(d){const{getPdfFromServer:i}=ce(),t=se().hash.slice(1);async function C(){const a=await i(t),_=new Blob([a],{type:"application/pdf"});if("msSaveOrOpenBlob"in navigator)window.navigator.msSaveOrOpenBlob(_,`${t}.pdf`);else{let A=window.URL.createObjectURL(_),p=document.createElement("a");p.href=A,p.setAttribute("download",`${t}.pdf`),p.click()}}function b(){window.print()}return(a,_)=>(s(),n("div",lt,[e("button",{class:"receiptResult__btns-save btn",onClick:C},l(a.$t("receiptArea.btn_save_receipt")),1),e("button",{class:"receiptResult__btns-print btn",onClick:b},l(a.$t("receiptArea.btn_view_receipt")),1)]))}};const it={key:0,class:"receiptArea"},rt={key:0,class:"receiptArea__get-receipt-container"},nt={for:"customer.agree_get_receipt"},ot={class:"receiptArea__form-title"},ct={class:"receiptArea__form-fields"},ut={key:1,class:"receiptArea__form-fields__separator"},dt={class:"receiptArea__checkbox-container"},pt={for:"customer.agree_get_receipt"},_t={key:0,class:"receiptArea__btns"},mt=["disabled"],vt={class:"receiptArea__email-form-title"},bt={class:"receiptArea__form-fields"},gt={key:0,class:"receiptArea__btns"},ft=["disabled"],ht={key:1,class:"receiptResult"},$t={class:"receiptResult__title success"},yt={key:2,class:"receiptResult"},kt=["src"],At={class:"receiptResult__title"},Rt={class:"receiptResult__description"},Vt={props:{data:Object,dateTimeOptions:Object},setup(d){var J;const i=se(),u=i.hash.slice(1),t=z({msisdn:"",email:"",agree_get_receipt:!1,agree_data_processing:!0,agree_advertising:!0,checkSend:!0,checkView:!0,successfulSending:!1}),{sendingReceipt:C}=ce(),b=z(!1),a=z(!1),_=z(null),A=(J=Te)==null?void 0:J.isReceiptMobileInputVisible,p=U(()=>!t.value.agree_data_processing||!t.value.msisdn&&!t.value.email),g=(m,o)=>{let L=!1;return m||(L=[o]),L};function P(){t.value.agree_data_processing||_.value.inputRef.click()}function I(){t.value.agree_data_processing&&_.value.inputRef.click()}async function W(){const{back_url_s:m}=i.query,o={"customer.agreeDataProcessing":t.value.agree_data_processing,"customer.agreeAdvertising":t.value.agree_advertising,"customer.receiptUrl":ye(i==null?void 0:i.name,{back_url_s:m})};t.value.msisdn&&Object.assign(o,{msisdn:t.value.msisdn.replace(/[^0-9\d]/gi,"")}),t.value.email&&Object.assign(o,{email:t.value.email}),t.value.successfulSending=!!await C(u,o)}async function H(){t.value.successfulSending=!!await C(u,{email:t.value.email})}return(m,o)=>{var G,$,c,f,R,E,j,M,B,w;const L=oe("i18n-t"),K=ge("maska");return s(),n(O,null,[(s(),D(fe,{to:"body"},[b.value?(s(),D(ne,{key:0},{default:h(()=>[y(xe,{modelValue:b.value,"onUpdate:modelValue":o[0]||(o[0]=V=>b.value=V),onAccept:P,onReject:I},null,8,["modelValue"])]),_:1})):v("",!0),y(ie,{appear:"",name:"fade",mode:"in-out"},{default:h(()=>[a.value?(s(),D(ne,{key:0,class:"receipt-example"},{default:h(()=>[y(st,{modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=V=>a.value=V)},null,8,["modelValue"])]),_:1})):v("",!0)]),_:1})])),t.value.successfulSending?!((M=(j=d.data)==null?void 0:j.options)!=null&&M.customerReceiptAreaEnabled)&&((w=(B=d.data)==null?void 0:B.merchant)==null?void 0:w.emailReceiptEnabled)?(s(),n("div",ht,[e("div",$t,l(m.$t("receiptArea.successSendEmail")),1)])):(s(),n("div",yt,[e("img",{src:r(we),class:"receiptResult__img",alt:"img-success"},null,8,kt),e("div",At,l(m.$t("receiptArea.finish_title")),1),e("div",Rt,l(m.$t("receiptArea.finish_description")),1),y(me)])):(s(),n("div",it,[($=(G=d.data)==null?void 0:G.options)!=null&&$.customerReceiptAreaEnabled?(s(),n("div",rt,[y(te,{modelValue:t.value.agree_get_receipt,"onUpdate:modelValue":o[3]||(o[3]=V=>t.value.agree_get_receipt=V),name:"customer.agree_get_receipt",class:"receiptArea__get-receipt",rules:"required"},{default:h(()=>[e("label",nt,[X(l(m.$t("receiptArea.agree_get_receipt")),1),e("span",{class:"questionReceipt",onClick:o[2]||(o[2]=Q(V=>a.value=!0,["prevent"]))})])]),_:1},8,["modelValue"]),e("div",ot,l(m.$t("receiptArea.additional_service")),1)])):v("",!0),y(ie,{appear:"",name:"smooth",mode:"in-out"},{default:h(()=>{var V,q;return[((q=(V=d.data)==null?void 0:V.options)==null?void 0:q.customerReceiptAreaEnabled)&&t.value.agree_get_receipt?(s(),D(r(re),{key:0,class:k(["receiptArea__form",{open:t.value.agree_get_receipt}]),onSubmit:W},{default:h(({isSubmitting:F,errors:S})=>[e("div",ct,[r(A)?he((s(),D(ae,{key:0,modelValue:t.value.msisdn,"onUpdate:modelValue":o[4]||(o[4]=T=>t.value.msisdn=T),name:"msisdn",type:"tel",placeholder:"+7 (",rules:{required:g(t.value.email,"Msisdn"),phonenumber:!0},class:k(["clear-icon-visible",{invalid:S.msisdn,valid:!S.msisdn&&t.value.msisdn.length>17,"none-empty-input":t.value.msisdn}]),label:m.$t("receiptArea.phoneTitle"),error:S},null,8,["modelValue","rules","class","label","error"])),[[K,"+7 (###) ### ## ##"]]):v("",!0),r(A)?(s(),n("div",ut,l(m.$t("receiptArea.separator")),1)):v("",!0),y(ae,{modelValue:t.value.email,"onUpdate:modelValue":o[5]||(o[5]=T=>t.value.email=T),name:"email",type:"email",class:k(["clear-icon-visible",{invalid:S.email,valid:!S.email&&t.value.email.length,"none-empty-input":t.value.email}]),rules:{required:g(t.value.msisdn,"Email"),email:!0},label:m.$t("receiptArea.emailTitle"),error:S,"validate-on-input":!0},null,8,["modelValue","class","rules","label","error"])]),e("div",dt,[y(te,{ref_key:"checkboxRef",ref:_,modelValue:t.value.agree_data_processing,"onUpdate:modelValue":o[7]||(o[7]=T=>t.value.agree_data_processing=T),name:"customer.agree_data_processing",class:k(["receiptArea__processing",{"checkbox-error":S["customer.agree_data_processing"]}]),rules:{required:g(t.value.agree_data_processing,"Checkbox")},error:S,checked:""},{default:h(()=>[y(L,{keypath:"receiptArea.agree_data_processing",tag:"label",for:"customer.agree_data_processing",scope:"global"},{default:h(()=>[e("span",{class:"terms",onClick:o[6]||(o[6]=Q(T=>b.value=!0,["prevent"]))},l(m.$t("receiptArea.agree_data_processing_word")),1)]),_:1}),y(r($e),{name:"customer.agree_data_processing",class:"input__error"})]),_:2},1032,["modelValue","class","rules","error"]),y(te,{modelValue:t.value.agree_advertising,"onUpdate:modelValue":o[9]||(o[9]=T=>t.value.agree_advertising=T),name:"customer.agree_advertising",class:"receiptArea__advertising",error:S,label:m.$t("receiptArea.agree_advertising"),checked:""},{default:h(()=>[e("label",pt,[X(l(m.$t("receiptArea.agree_get_receipt")),1),e("span",{class:"questionReceipt",onClick:o[8]||(o[8]=Q(T=>a.value=!0,["prevent"]))})])]),_:2},1032,["modelValue","error","label"])]),d.data.state==="result"?(s(),n("div",_t,[e("button",{disabled:F||Object.keys(S).length,class:k(["btn btn-primary",{disabled:F||Object.keys(S).length||r(p)}]),type:"submit"},l(m.$t("receiptArea.btn_send_receipt")),11,mt)])):v("",!0)]),_:1},8,["class"])):v("",!0)]}),_:1}),!((f=(c=d.data)==null?void 0:c.options)!=null&&f.customerReceiptAreaEnabled)&&((E=(R=d.data)==null?void 0:R.merchant)==null?void 0:E.emailReceiptEnabled)?(s(),D(r(re),{key:1,class:"receiptArea__form email open",onSubmit:H},{default:h(({isSubmitting:V,errors:q})=>[e("p",vt,l(m.$t("receiptArea.formTitle")),1),e("div",bt,[y(ae,{modelValue:t.value.email,"onUpdate:modelValue":o[10]||(o[10]=F=>t.value.email=F),name:"email",type:"email",class:k({"none-empty-input":t.value.email,invalid:q.email}),rules:{required:!0,email:!0},label:m.$t("receiptArea.emailTitle"),error:q},null,8,["modelValue","class","label","error"])]),d.data.state==="result"?(s(),n("div",gt,[t.value.successfulSending?v("",!0):(s(),n("button",{key:0,disabled:V,class:"btn btn-primary"},l(m.$t("receiptArea.btn_send_email_receipt")),9,ft))])):v("",!0)]),_:1})):v("",!0)]))],64)}}},St={class:"receipt-print"},Ct={class:"table-header"},Tt={class:"table-body main-info"},Et={class:"title"},wt={class:"text"},It=["onClick"],Dt={class:"title"},Ut={class:"text"},Ot={class:"title"},jt={class:"text"},Mt={class:"receipt-container"},Bt={class:"stamp-container"},qt={key:0,src:pe},xt={props:{title:{type:String,required:!0},data:{type:Object},dateTimeOptions:{type:Object}},setup(d){const i=d,{t:u,locale:t}=Z(),C=U(()=>{var a,_,A,p;return[{key:u("pages.result.table.portal"),value:i.data.merchant.name},{key:u("pages.result.table.description"),value:i.data.description},{key:u("pages.result.table.pan"),value:((a=i.data.src)==null?void 0:a.pan)||((_=i.data.dst)==null?void 0:_.pan)},{key:u("pages.result.table.brand"),value:((A=i.data.src)==null?void 0:A.paymentSystem)||((p=i.data.dst)==null?void 0:p.paymentSystem)},{key:u("pages.result.table.trxId"),value:i.data.result.trxId},{key:u("pages.result.table.externalTrxId.sbp"),value:i.data.result.externalTrxId},{key:u("pages.result.table.date"),value:new Date(i.data.finishedAt).toLocaleString(t.value,i.dateTimeOptions)},{key:u("pages.result.table.approvalCode"),value:i.data.result.approvalCode},{key:u("pages.result.table.rrn"),value:i.data.result.rrn},{key:u("pages.result.table.amount"),value:i.data.amount&&`${Y.formatCurrency(i.data.amount)} ${u("currency")}`,class:"amount"}].filter(g=>g.value)});function b(a){const _=i.data.items.find((A,p)=>p===a);_.isDetailedInfoVisible?delete _.isDetailedInfoVisible:Object.assign(_,{isDetailedInfoVisible:!0})}return(a,_)=>{var A,p;return s(),n("div",St,[e("h2",Ct,l(a.$t(d.title)),1),e("table",Tt,[(s(!0),n(O,null,x(r(C),g=>(s(),n("tr",{key:g.key,class:k(g.class)},[e("td",Et,l(g.key),1),e("td",wt,l(g.value),1)],2))),128))]),(s(!0),n(O,null,x((A=i.data)==null?void 0:A.items,(g,P)=>(s(),n("table",{key:g.name,class:k(["table-body",{visible:g.isDetailedInfoVisible}]),onClick:I=>b(P)},[e("caption",null,l(g.name),1),e("tr",null,[e("td",Dt,l(a.$t("pages.result.table.amount")),1),e("td",Ut,l(r(Y).formatCurrency(g.sum))+" "+l(r(u)("currency")),1)]),(s(!0),n(O,null,x(g.fields,(I,W)=>(s(),n("tr",{key:I,class:k(["detailed-info",{visible:g.isDetailedInfoVisible}])},[e("td",Ot,l(W),1),e("td",jt,l(I),1)],2))),128))],10,It))),128)),e("div",Mt,[e("div",Bt,[((p=i.data)==null?void 0:p.result.status)===r(N).SUCCESS?(s(),n("img",qt)):v("",!0)]),y(me)]),y(_e)])}}},Pt={key:0,class:"content-wrapper bill"},Lt=e("div",{class:"bill-form__header-icon"},null,-1),Ft={key:0,class:"bill-form__header-amount"},Ht={class:"bill-form__header-title"},Nt={key:1,class:"bill-form__header-unknown"},zt={key:2,class:"bill-form__header-description"},Wt=["innerHTML"],Gt={class:"bill-form__main"},Yt={class:"value"},Jt={key:0,class:"gpb_banner__container"},Kt=["href"],Qt=["src"],Xt={key:1,class:"bill-form__btns"},Zt=["href"],ea=e("img",{class:"angle-right",src:be,alt:"angle-right-icon"},null,-1),ca={setup(d){const{t:i}=Z(),u=se(),{globalLoaderHide:t}=Se(),{apiErrorHandlerOn:C,apiErrorHandlerOff:b}=ke(),{paymentState:a,getPaymentStateResultStatus:_}=Ae(),{redirectTimeout:A,cardRegistrationPage:p}=window.settings,g=z(null),{back_url_s:P}=u.query,I=location.origin+location.pathname+`?back_url_s=${P}`+location.hash===location.href||location.origin+location.pathname+location.hash===location.href,W=U(()=>{var c;return $.value.class==="success"&&!I&&!((c=u.query)!=null&&c.preauthorize)}),H=z(null),J=U(()=>{var c,f;return(a.value.result.status===N.SUCCESS||a.value.result.status===N.INTERIM_SUCCESS)&&a.value.result.orderStatus!==N.REGISTERED&&((f=(c=a.value.options)==null?void 0:c.bannerData)==null?void 0:f.bannerImageUrl)}),m=U(()=>{var c,f,R,E;return $.value.description&&!p?!0:!!($.value.description&&p&&!((f=(c=a.value)==null?void 0:c.src)!=null&&f.type)&&((E=(R=a.value)==null?void 0:R.result)==null?void 0:E.status)!==N.SUCCESS)}),o=U(()=>a.value.result.orderStatus!==N.REGISTERED&&G.value.length>3),L={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"},K=U(()=>{var c,f,R;return!$.value.class==="success"?null:(f=(c=a.value)==null?void 0:c.descriptionParams)!=null&&f.amountWithAcquirerCommission?Y.formatCurrency(a.value.descriptionParams.amountWithAcquirerCommission,a.value.currency):(R=a.value)!=null&&R.amount?Y.formatCurrency(a.value.amount,a.value.currency):null}),G=U(()=>{var c,f,R,E,j,M,B,w,V,q,F,S,T,le;return[{title:i("pages.result.table.merchant"),value:Y.urlToStringWithoutProtocol((f=(c=a.value)==null?void 0:c.merchant)==null?void 0:f.url)},{title:i("pages.result.table.description"),value:(R=a.value)==null?void 0:R.description},{title:i("pages.result.table.pan"),value:(j=(E=a.value)==null?void 0:E.src)==null?void 0:j.pan},{title:i("pages.result.table.pan"),value:(B=(M=a.value)==null?void 0:M.dst)==null?void 0:B.pan},{title:i("pages.result.table.date"),value:new Date((w=a.value)==null?void 0:w.finishedAt).toLocaleString("ru",L)},{title:i("pages.result.table.rrn"),value:(V=a.value)==null?void 0:V.result.rrn},{title:i("pages.result.table.approvalCode"),value:(q=a.value)==null?void 0:q.result.approvalCode},{title:i("pages.result.table.trxId"),value:(F=a.value)==null?void 0:F.result.trxId,class:"trxId"},{title:i(`pages.result.table.externalTrxId.${(T=(S=a.value)==null?void 0:S.src)==null?void 0:T.type}`),value:(le=a.value)==null?void 0:le.result.externalTrxId}].filter(ve=>ve.value)}),$=U(()=>{var c;return _((c=a.value)==null?void 0:c.result)});return Re(()=>{var c;C(),A&&setTimeout(()=>g.value.click(),A*1e3),Ee(a),(c=a.value)!=null&&c.result.status&&t()}),Ve(()=>b()),(c,f)=>{var R,E,j,M,B;return r(a)?(s(),n("div",Pt,[e("div",{class:k(["bill-form",r($).class])},[e("div",{class:k(["bill-form__header",r($).class])},[Lt,r(K)?(s(),n("div",Ft,l(r(K)),1)):v("",!0),e("div",Ht,l(c.$t(r($).title)),1),r($).unknown?(s(),n("div",Nt,l(c.$t("pages.result.status.unknown")),1)):v("",!0),r(m)?(s(),n("div",zt,l(c.$t(r($).description," ")),1)):v("",!0),r($).offline?(s(),n("div",{key:3,class:"bill-form__header-offline",innerHTML:c.$t(r($).message)},null,8,Wt)):v("",!0)],2),e("div",Gt,[e("div",{class:k(["bill-form__main-transaction",{open:H.value}])},[(s(!0),n(O,null,x(r(G),w=>(s(),n("div",{key:w.value,class:"bill-form__main-transaction-item"},[e("div",{class:k(["title",w.class])},l(w.title),3),e("div",Yt,l(w.value),1)]))),128))],2),r(o)?(s(),n("div",{key:0,class:k(["bill-form__main-readMore",{isVisibleDetail:H.value}]),onClick:f[0]||(f[0]=w=>H.value=!H.value)},l(c.$t("pages.result.readMore")),3)):v("",!0)]),r(W)?(s(),D(Vt,{key:0,data:r(a)},null,8,["data"])):v("",!0),r(a)&&!r(p)?(s(),D(xt,{key:1,class:k({visible:r(I)}),title:(R=r($))==null?void 0:R.title,data:r(a),"date-time-options":L},null,8,["class","title","data"])):v("",!0)],2),r(J)?(s(),n("div",Jt,[e("a",{class:"gpb__banner",target:"_blank",href:(j=(E=r(a).options)==null?void 0:E.bannerData)==null?void 0:j.bannerRedirectUrl},[e("img",{src:(B=(M=r(a).options)==null?void 0:M.bannerData)==null?void 0:B.bannerImageUrl,alt:"banner"},null,8,Qt)],8,Kt)])):v("",!0),!r(I)||r(P)?(s(),n("div",Xt,[e("a",{id:"submitBtn",ref_key:"returnToShopBtn",ref:g,href:r(I)?r(P):r($).backUrl,class:"btn back-to-merchant"},[X(l(c.$t("ui.btn.goToMerchant"))+" ",1),ea],8,Zt)])):v("",!0)])):v("",!0)}}};export{ca as default};
