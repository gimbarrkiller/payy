import{c as M,r as j,w as U,o as r,a as I,u as e,n as C,b,d as A,e as o,t as $,p as re,f as ce,g as pe,h as B,i as X,j as D,S as ue,k as G,A as z,l as Le,F as Oe,m as S,q as de,s as me,v as Q,T as ye,x as xe,y as Z,z as H,B as V,C as _e,D as qe,E as Fe,G as Ge,H as ze,I as je,P as F,J as ie,K as He,L as Ye,M as Ke,N as Je,O as We,Q as W,R as Qe}from"./gpb-fns.1cc41912.js";import{u as Xe,_ as Ze,a as et,M as tt,b as at,c as st,V as ot,U as nt}from"./MASTERCARD.e366ccdc.js";import{_ as it}from"./angle-right_blue.3c01ebe8.js";import{u as ve}from"./useLoader.c46ce039.js";import{_ as ge,o as lt,D as rt,a as ct}from"./Checkbox.2b9c2cae.js";import{_ as pt}from"./loader.d6ef5f93.js";import{_ as ut}from"./DebugMode.fac855d4.js";import{_ as L}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as dt}from"./FormHeader.277ef804.js";import{c as mt}from"./config.4dc2f738.js";var yt="assets/question.47741165.svg";const _t={props:{errors:{type:Object,default:{}},minPanLength:{type:Number}},setup(n){const a=n,l=M(()=>({required:!0,pan:[{minPanLength:a.minPanLength}]}));return(p,g)=>{const P=j("maska");return U((r(),I(ge,{name:"pan",rules:e(l),type:"tel",label:p.$t("ui.input.pan.label"),class:C({invalid:a.errors.pan})},null,8,["rules","label","class"])),[[P,"#### #### #### #### ###"]])}}},vt={props:{data:Object,type:String,isCombined:{type:Boolean,default:!1},errors:{type:Object,default:{}}},setup(n){const a=n,l=M(()=>{var p,g;return{required:!0,[a.type]:[{isExpiredCardsAllowed:!!((g=(p=a.data)==null?void 0:p.options)!=null&&g.expiredCardsAllowed),isCombined:a.isCombined}]}});return(p,g)=>{const P=j("maska");return U((r(),I(ge,{type:"tel",name:n.type,class:C({invalid:a.errors[a.type]}),rules:e(l),label:p.$t(`ui.input.${a.type}.label`)},null,8,["name","class","rules","label"])),[[P,"##"]])}}};const gt=n=>(re("data-v-af30766c"),n=n(),ce(),n),Pt={class:"content-wrapper"},ft={class:"loader-container"},ht=gt(()=>o("img",{class:"loader__img",src:pt},null,-1)),bt={class:"loader_title"},kt={class:"loader_subTitle"},wt={setup(n){const{pageDebugMode:a}=window.settings;return(l,p)=>(r(),b("div",Pt,[e(a)?(r(),I(ut,{key:0})):A("",!0),o("div",ft,[ht,o("h2",bt,$(l.$t("loading.title")),1),o("p",kt,$(l.$t("loading.subTitle")),1)])]))}};var Ct=L(wt,[["__scopeId","data-v-af30766c"]]);function Pe(n){const{back_url_s:a}=n.query,{isReceiptBackUrlEnabled:l}=mt;return l?pe(n.name,{back_url_s:a}):null}const Tt={props:{data:Object},setup(n){const{fastPaymentMethod:a}=B(),{globalLoaderShow:l}=X(),p=D(),g=Pe(p);return(P,m)=>(r(),b("button",{class:"gpp-button btn",onClick:m[0]||(m[0]=R=>{var f,i;return e(a)(e(ue).gazprom_pay,(i=(f=n.data)==null?void 0:f.options)==null?void 0:i.customerReceiptAreaEnabled,e(l),{customerReceiptUrl:e(g)})})}))}};var $t=L(Tt,[["__scopeId","data-v-c0c25c54"]]);const le={props:{data:Object},setup(n){const a=n,{initPayment:l,checkPaymentState:p}=B(),{startGooglePayment:g}=G(),{globalLoaderShow:P}=ve(),m=D().hash.slice(1),{googlePay:R}=window.settings,f="TEST";let i=new google.payments.api.PaymentsClient({environment:R.googlePayEnvironment||f});const k={isPaymentRequest:!1,googlePayClient:i};let w=s();k.isPaymentRequest=!0,i.isReadyToPay(w).then(function(t){t.result?(i.createButton({buttonColor:"white",buttonType:"short",onClick:h}),v(a.data)):console.log("Google Pay is not available")}).catch(function(t){console.error(t)});function s(){var t=["PAN_ONLY","CRYPTOGRAM_3DS"],u=["MASTERCARD","VISA"];return{apiVersion:2,apiVersionMinor:0,allowedPaymentMethods:[{type:"CARD",parameters:{allowedAuthMethods:R.googlePayAllowedCardAuthMethods||t,allowedCardNetworks:R.googlePayAllowedCardNetworks||u}}]}}function y(t){let u=Object.assign({},s()),_=R.googlePayRequestType||"PAYMENT_GATEWAY";return u.allowedPaymentMethods[0].tokenizationSpecification={type:_},_=="DIRECT"?(u.allowedPaymentMethods[0].tokenizationSpecification={parameters:{protocolVersion:"ECv2",publicKey:t.options.googlePayMerchantPublicKey}},u.merchantInfo={merchantId:t.options.googlePayMerchantId}):u.allowedPaymentMethods[0].tokenizationSpecification.parameters={gateway:t.options.googlePayGatewayId,gatewayMerchantId:t.options.googlePayGatewayMerchantId},u.merchantInfo={merchantName:t.options.googlePayMerchantName,merchantOrigin:t.options.googlePayMerchantOrigin,merchantId:t.options.googlePayGatewayMerchantId},u.transactionInfo={countryCode:"RU",currencyCode:t.currency,totalPriceStatus:"FINAL",totalPrice:(t.amount/100).toFixed(2).toString()},u}function v(t){var u=y(t);u.transactionInfo={totalPriceStatus:"NOT_CURRENTLY_KNOWN",currencyCode:t.currency},k.googlePayClient.prefetchPaymentData(u)}function h(){let t=y(a.data);k.googlePayClient.loadPaymentData(t).then(function(u){let _=u.paymentMethodData.tokenizationData.token;P(),g(m,_).then(Y=>p(Y,m)).catch(()=>l())}).catch(function(u){console.error(u)})}return(t,u)=>k.isPaymentRequest?(r(),b("button",{key:0,type:"button","aria-label":"Google Pay",class:"btn gpay-button black short en",onClick:h})):A("",!0)}};const Rt={props:{data:Object},setup(n){const a=D().hash.slice(1),{initPayment:l,checkPaymentState:p}=B(),{getApplePaySession:g,startApplePayPayment:P}=G(),R=ApplePaySession.supportsVersion(z.eleven)?z.eleven:z.one;function f(i,k,w){var s={countryCode:"RU",currencyCode:k.currency,total:{label:k.merchant.name,amount:Oe.amountMinorToAmount(k.amount)},supportedNetworks:["masterCard","visa"],merchantCapabilities:["supports3DS"]};w===z.eleven&&s.supportedNetworks.push("mir");const y=new ApplePaySession(w,s);i.applePaySession=y,y.onvalidatemerchant=function(v){const h=v.validationURL;i.appleValidationRes?y.completeMerchantValidation(i.appleValidationRes):g(a,h).then(t=>{t.epochTimestamp=Number(t.epochTimestamp),t.expiresAt=Number(t.expiresAt),i.appleValidationRes=t,y.completeMerchantValidation(t)}).catch(()=>l())},y.onpaymentauthorized=function(v){const h=v.payment;h.token&&h.token.paymentMethod&&!h.token.paymentMethod.type&&(h.token.paymentMethod.type="unknown"),P(a,h).then(t=>p(t,a)).catch(()=>l())},y.begin()}return(i,k)=>{const w=Le("apple-pay-button");return r(),I(w,{buttonstyle:"black",type:"plain",locale:"en-US",class:"apple-pay-button btn",onClick:k[0]||(k[0]=s=>f({},n.data,e(R)))})}}};var At=L(Rt,[["__scopeId","data-v-3d0120f9"]]),St="assets/mir_pay.bae7ec04.svg",Mt="assets/mir_pay_form.3f8b3bd8.svg";const Et=n=>(re("data-v-f106fe48"),n=n(),ce(),n),It={key:0,class:"modalMir"},Vt=Et(()=>o("div",{class:"loaderMir"},[o("div",{class:"lds-ellipsis"},[o("div"),o("div"),o("div"),o("div")])],-1)),Dt={class:"mirForm-top-text"},Nt=["src"],Ut={class:"mirForm-text"},Bt={href:"https://play.google.com/store/apps/details?id=ru.nspk.mirpay"},Lt=["onClick"],Ot=["src"],xt={props:{data:Object},emits:["updatePaymentState"],setup(n,{emit:a}){const l=n,p=D(),{mirPayResetTimer:g=10}=window.settings,P=S(!1),m=S(!1),{startNewMirPayPayment:R,decline:f}=G(),{checkPaymentState:i,handleState:k}=B();let w=p.hash.slice(1),s;async function y(){if(m.value)P.value=!1;else{P.value=!1,clearInterval(s);const t=p.hash.slice(1),u=await f(t);a("updatePaymentState",u)}}async function v(){m.value=!1,window.location.href=l.data.options.mirPayLink,P.value=!0;const t=await R(w);await i(t,w),s=setInterval(async()=>await k(w),g*1e3)}function h(){m.value=!0,P.value=!0}return de(async()=>{var t,u;(u=(t=l.data)==null?void 0:t.options)!=null&&u.mirPayInProgress?(P.value=!0,s=setInterval(async()=>await k(w),g*1e3)):p.query["src.type"]===ue.mir_pay&&h()}),me(()=>clearInterval(s)),(t,u)=>(r(),b(H,null,[(r(),I(ye,{to:"body"},[P.value?(r(),b("div",It,[o("div",{class:C(["mirForm",{accept:m.value}])},[Vt,o("div",Dt,$(t.$t("pages.main.mirPay.mirPayTopText")),1),o("img",{src:e(Mt),class:"mirForm-logo"},null,8,Nt),o("div",Ut,[Q($(t.$t("pages.main.mirPay.mirPayTextStart"))+" ",1),o("a",Bt,$(t.$t("pages.main.mirPay.mirPayUrl")),1),Q(" "+$(t.$t("pages.main.mirPay.mirPayTextEnd")),1)]),m.value?(r(),b("button",{key:0,type:"button",class:"btn mir-button",onClick:v},$(t.$t("pages.main.mirPay.mirPayAcceptBtn")),1)):A("",!0),o("a",{class:"mirForm-btn",onClick:y},$(t.$t("pages.main.mirPay.mirPayBtn")),1)],2)])):A("",!0)])),o("button",xe(t.$attrs,{class:"mir-button btn",onClick:Z(v,["stop","prevent"])}),[o("img",{src:e(St),alt:""},null,8,Ot)],16,Lt)],64))}};var qt=L(xt,[["__scopeId","data-v-f106fe48"]]);const Ft={props:{data:Object},setup(n){const{fastPaymentMethod:a}=B(),{globalLoaderShow:l}=X(),p=D(),g=Pe(p);return(P,m)=>(r(),b("button",{class:"btn sbp-button",onClick:m[0]||(m[0]=R=>{var f,i;return e(a)("sbp",(i=(f=n.data)==null?void 0:f.options)==null?void 0:i.customerReceiptAreaEnabled,e(l),{customerReceiptUrl:e(g)})})}))}};var Gt=L(Ft,[["__scopeId","data-v-0ef751bc"]]),zt="assets/angle-down-black.d4c0b535.svg";const jt={props:{modelValue:{type:Boolean,required:!0}},setup(n){return(a,l)=>(r(),b("img",{class:C(["angle-down",{open:n.modelValue}]),src:zt,onClick:l[0]||(l[0]=Z(p=>a.$emit("update:modelValue",!n.modelValue),["stop"]))},null,2))}};const Ht={class:"sbp-title"},Yt={class:"paymentButtons"},Kt={props:{data:Object},setup(n){const a=n,{isToggleButtonEnabled:l,mirPayDesktopShow:p,applePay:g,googlePay:P}=window.settings,m=[],R=D().query.gpay||P.gpay,f=S(!1),i=M(()=>(window==null?void 0:window.google)&&R&&a.data.options&&(a.data.options.googlePayMerchantPublicKey||P.googlePayRequestType!="DIRECT"&&a.data.options.googlePayGatewayId)),k=M(()=>(g==null?void 0:g.applePayEnabled)&&window.ApplePaySession&&a.data.options.applePayMerchantIdentifier),w=M(()=>{var s,y,v,h,t;return!!((((s=a.data)==null?void 0:s.options)&&((v=(y=a.data)==null?void 0:y.options)==null?void 0:v.mirPayLink)||((t=(h=a.data)==null?void 0:h.options)==null?void 0:t.mirPayInProgress))&&(/Android/i.test(navigator.userAgent)||p))});if(i.value&&m.push(le),k.value){let s=a.data.options.applePayMerchantIdentifier;window.ApplePaySession.canMakePaymentsWithActiveCard(s).then(function(v){v&&m.push(At)})}return a.data.options&&a.data.options.sbpEnabled&&m.push(Gt),w.value&&m.push(qt),(s,y)=>m.length?(r(),b("div",{key:0,class:C({"toggleable-content":e(l)&&!f.value,"toggleable-content visible":e(l)&&f.value})},[e(l)?(r(),b("div",{key:0,class:"sbp-title-container",onClick:y[1]||(y[1]=v=>f.value=!f.value)},[o("h4",Ht,$(s.$t("pages.main.sbpTitle")),1),V(jt,{modelValue:f.value,"onUpdate:modelValue":y[0]||(y[0]=v=>f.value=v)},null,8,["modelValue"])])):A("",!0),o("div",Yt,[(r(),b(H,null,_e(m,v=>o("div",{key:v,class:"paymentButtons_item"},[(r(),I(qe(v),{data:n.data,class:C({"white long":v===le}),onUpdatePaymentState:y[2]||(y[2]=h=>s.$emit("updatePaymentState",h))},null,8,["data","class"]))])),64))])],2)):A("",!0)}};var Jt=L(Kt,[["__scopeId","data-v-0139ef7e"]]),Wt="assets/JCB.7e240993.svg",Qt="assets/Default.9aa84ae2.svg";const Xt=o("div",{id:"acs"},null,-1),Zt={key:1,class:"gaz-prom-pay"},ea={class:"gaz-prom-pay__description-container"},ta={class:"gaz-prom-pay__description"},aa={class:"help-tooltip__title"},sa={class:"help-tooltip__description"},oa={class:"main-form"},na={class:"pay-title-container"},ia={class:"pay-title"},la={class:"icons-container"},ra={key:0,class:"card-brand"},ca=["src"],pa=o("div",{class:"cvc-logo"},[o("img",{src:et,alt:"CVC"})],-1),ua={key:1,class:"checkbox-container"},da={class:"pay-btn-container"},ma=["disabled"],ya={class:"back-to-merchant-container"},_a=o("img",{class:"angle-right",src:it},null,-1),$a={setup(n){const{cardRegistrationPage:a}=window.settings,{t:l}=Fe(),p=D(),{setTabTitle:g}=Ge(),{accept:P,start:m,decline:R}=G(),{handleSubmit:f,errors:i,setFieldError:k,isSubmitting:w}=ze(),{card:s,getSrcCardParams:y,getDstCardParams:v,getCardParams:h}=Xe(),{initPayment:t,checkPaymentState:u,paymentState:_,requestPaymentState:Y,checkRegistrationToken:fe,replaceRoute:he}=B(),K=S(!1),{localeLoaderShow:be,globalLoaderShow:ke,hideLoaders:we}=ve(K),{requestProcessing:ee}=X(),{iframeHandler:Ce,apiErrorHandlerOn:Te,apiErrorHandlerOff:$e}=je(),Re=16,te=S(!1),O=S(!1),J=S(!1),x=S(!1),ae=S(null),Ae=S(!1),Se=S(!1),Me=S(!1),se=M(()=>s.pan?We(s.pan,{MIR:tt,MASTERCARD:at,MAESTRO:st,VISA:ot,UPI:nt,JCB:Wt},Qt):""),Ee=M(()=>{let c=!0;return(_.value.paymentId===F.OCT&&s.pan||s.pan&&s.pan.length>W.PAN&&s.cvc&&s.cvc.length>W.CVC&&s.expiry&&s.expiry.length>W.EXPIRY)&&(c=!1),c}),Ie=M(()=>_.value.paymentId!==F.OCT),Ve=M(()=>{var c;return(!_.value.paymentId||_.value.paymentId===F.TRANSP_DEBT)&&((c=_.value.src)==null?void 0:c.addToProfileEnabled)}),oe=M(()=>a?"continue":_.value.paymentId===F.OCT?"transferToCard":"pay"),De=M(()=>w.value||O.value||K.value),Ne=M(()=>_.value&&!te.value&&!K.value&&!J.value);lt(ae,()=>{x.value=!1});const ne=f(async()=>{var q;O.value=!0,ee();let c=p.hash.slice(1),d,E;if(a?E=h(s):_.value.paymentId===F.OCT&&!a?E=v(s.pan):E=y(s),(q=_.value.options)!=null&&q.customerReceiptAreaEnabled){const{back_url_s:N}=p.query;Object.assign(E,{"customer.receiptUrl":pe("",{back_url_s:N})})}if(a){const{token:N}=await G().token();c=N,await he(c),E.returnUrl=window.location.href,d=await m(c,E)}else d=await P(c,E);O.value=!1,be(),te.value=!0,await u(d,c)}),Ue=async c=>{c.error===Qe.UNEXPECTED_REQUEST?await Y(_):(k("pan",l(`errors.api.${c.error}`)),O.value=!1)};async function Be(){ee();const c=p.hash.slice(1);try{await R(c)}catch(d){console.log(d)}finally{location.href=p.query.back_url_f}}return de(async()=>{var c,d;window.frameElement?console.log("frame"):(Ce(J),Te(Ue),ke(),a?await fe():await t(),((c=_.value)==null?void 0:c.state)!==ie.REDIRECT&&((d=_.value)==null?void 0:d.state)!==ie.RESULT&&(we(),g()))}),me(()=>{$e()}),(c,d)=>{var N;const E=j("maska"),q=j("focus-next");return r(),b(H,null,[(r(),I(ye,{to:"body"},[U(V(rt,null,{default:Ye(()=>[Xt]),_:1},512),[[He,J.value]])])),e(De)?(r(),I(Ct,{key:0})):A("",!0),e(Ne)?(r(),b("div",{key:1,class:C(["content-wrapper main",{submit:e(w)||O.value}])},[e(a)?A("",!0):(r(),I(dt,{key:0,data:e(_)},null,8,["data"])),((N=e(_).options)==null?void 0:N.gazpromPayEnabled)&&!e(a)?(r(),b("div",Zt,[o("div",ea,[o("p",ta,$(c.$t("pages.main.gazpromPay")),1),o("img",{class:C(["help-icon",{disable:x.value}]),src:yt,onClick:d[0]||(d[0]=T=>x.value=!x.value)},null,2),o("div",{ref_key:"tooltipRef",ref:ae,class:C(["help-tooltip",{visible:x.value}])},[o("h4",aa,$(c.$t("pages.main.helpTooltip.title")),1),o("p",sa,$(c.$t("pages.main.helpTooltip.description")),1)],2)]),V($t,{data:e(_)},null,8,["data"])])):A("",!0),o("form",{onKeydown:d[6]||(d[6]=Je(Z(()=>{},["prevent"]),["enter"]))},[o("div",oa,[o("div",na,[o("h4",ia,$(c.$t(`pages.main.payTitle.${e(oe)}`)),1)]),o("div",{class:C(["pan-input-container",{invalid:e(i).pan,active:Ae.value&&!e(i).pan}])},[U(V(_t,{modelValue:e(s).pan,"onUpdate:modelValue":d[1]||(d[1]=T=>e(s).pan=T),class:C(["clear-icon-visible",{"none-empty-input":e(s).pan}]),errors:e(i),"min-pan-length":Re},null,8,["modelValue","class","errors"]),[[E,e(Ke)]]),o("div",la,[e(se).length?(r(),b("div",ra,[(r(!0),b(H,null,_e(e(se),T=>(r(),b("img",{key:T,src:T,alt:"Brand"},null,8,ca))),128))])):A("",!0)])],2),e(Ie)?(r(),b("div",{key:0,class:C(["expiry-cvc-input-container",{invalid:e(i).expiry||e(i).cvc}])},[o("div",{class:C(["expiry-input-group",{invalid:e(i).expiry,active:Se.value&&!e(i).expiry}])},[U(V(vt,{modelValue:e(s).expiry,"onUpdate:modelValue":d[2]||(d[2]=T=>e(s).expiry=T),data:e(_),class:C({"none-empty-input":e(s).expiry}),type:"expiry","is-combined":"",errors:e(i)},null,8,["modelValue","data","class","errors"]),[[q,{length:7,target:"cvc"}],[E,"## / ##"]])],2),o("div",{class:C(["cvc-input-group",{invalid:e(i).cvc,active:Me.value&&!e(i).cvc}])},[U(V(Ze,{modelValue:e(s).cvc,"onUpdate:modelValue":d[3]||(d[3]=T=>e(s).cvc=T),class:C({"none-empty-input":e(s).cvc}),errors:e(i)},null,8,["modelValue","class","errors"]),[[q,{length:3,target:"addToProfile"}]]),pa],2)],2)):A("",!0),e(Ve)&&!e(a)?(r(),b("div",ua,[V(ct,{modelValue:e(s).save,"onUpdate:modelValue":d[4]||(d[4]=T=>e(s).save=T),name:"addToProfile",class:"addToProfile",label:c.$t("ui.input.saveCard.label")},null,8,["modelValue","label"])])):A("",!0),o("div",da,[o("button",{id:"submitBtn",type:"button",disabled:e(w)||Object.keys(e(i)).length||e(Ee),class:"btn btn-primary",onClick:d[5]||(d[5]=(...T)=>e(ne)&&e(ne)(...T))},$(c.$t(`ui.btn.${e(oe)}`)),9,ma)])])],32),e(a)?A("",!0):(r(),I(Jt,{key:2,data:e(_),onUpdatePaymentState:d[7]||(d[7]=T=>_.value=T)},null,8,["data"])),o("div",ya,[o("button",{class:"btn back-to-merchant",onClick:Be},[Q($(c.$t("ui.btn.goToMerchant"))+" ",1),_a])])],2)):A("",!0)],64)}}};export{$a as default};
