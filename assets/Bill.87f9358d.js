import{_ as Z}from"./angle-right_blue.3c01ebe8.js";import{B as Q,h as F,o as i,d as n,i as l,t as r,k as N,x as W,u as s,e as X,c as P,g as x,a as M,J as I,v as D,f as d,T as ee,s as Y,n as w,L as z,ag as te,p as ae,b as se,D as le,E as ie,F as G,ah as q,j as re,q as ne,P as J}from"./gpb-new.9481ec94.js";import{o as oe,D as ce,a as H,_ as K}from"./Dialog.55d98c8a.js";import{u as ue}from"./usePaymentAvailability.27b8d1fe.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./useLoader.013ecf08.js";var de="assets/receiptSuccess.30f6166a.svg",_e="assets/close.aef81234.svg";const me={class:"header"},pe={class:"modal-content"},ve={class:"modal-content__title"},ge={class:"modal-content__description"},be={class:"modal-content__list"},fe={class:"button-container"},he={props:{modelValue:{type:Boolean}},emits:["update:modelValue","accept"],setup(A,{emit:t}){const{tm:j}=Q(),U=j("receiptArea.agree_modal_content.description.personal_data_list"),a=j("receiptArea.agree_modal_content.description.agreements_text"),u=F(null);oe(u,()=>t("update:modelValue",!1));function g(){t("accept"),t("update:modelValue",!1)}return(m,S)=>(i(),n("div",{ref_key:"modalRef",ref:u,class:"modal"},[l("header",me,[l("img",{src:_e,onClick:S[0]||(S[0]=b=>m.$emit("update:modelValue",!1))})]),l("div",pe,[l("h2",ve,r(m.$t("receiptArea.agree_modal_content.title")),1),l("p",ge,r(m.$t("receiptArea.agree_modal_content.description.personal_data_list_title")),1),l("ul",be,[(i(!0),n(N,null,W(s(U),b=>(i(),n("li",{key:b,class:"modal-content__description"},r(b),1))),128))]),(i(!0),n(N,null,W(s(a),b=>(i(),n("p",{key:b,class:"modal-content__description"},r(b),1))),128))]),l("div",fe,[l("button",{class:"btn btn-primary",onClick:g},r(m.$t("ui.btn.accept")),1),l("button",{class:"btn btn-reject",onClick:S[1]||(S[1]=b=>m.$emit("update:modelValue",!1))},r(m.$t("ui.btn.reject")),1)])],512))}};const ye={key:0,class:"receiptArea"},ke={class:"receiptArea__form-title"},$e={class:"receiptArea__form-fields"},Ae={key:0,class:"receiptArea__btns"},Se=["disabled"],Te={class:"receiptArea__email-form-title"},Ve={class:"receiptArea__form-fields"},Re={key:0,class:"receiptArea__btns"},Ee=["disabled"],Ce={key:1,class:"receiptResult"},Ie={class:"receiptResult__title success"},De={key:2,class:"receiptResult"},we=["src"],Ue={class:"receiptResult__title"},Be={props:{data:Object},setup(A){const t=A,U=X().hash.slice(1),a=F({msisdn:"",email:"",agree_get_receipt:!1,agree_data_processing:!0,agree_advertising:!0,checkSend:!0,checkView:!0,successfulSending:!1}),{sendingReceipt:u}=ae(),g=F(!1),m=F(null),S=P(()=>!a.value.agree_data_processing||!a.value.msisdn&&!a.value.email),b=P(()=>{var o,e,c,p;return!((e=(o=t.data)==null?void 0:o.options)!=null&&e.customerReceiptAreaEnabled)&&((p=(c=t.data)==null?void 0:c.merchant)==null?void 0:p.emailReceiptEnabled)});function L(){a.value.agree_data_processing||m.value.inputRef.click()}async function _(){const o={"customer.agreeDataProcessing":a.value.agree_data_processing,"customer.agreeAdvertising":a.value.agree_advertising,"customer.receiptUrl":location.origin+"/"+window.location.hash};a.value.msisdn&&Object.assign(o,{msisdn:a.value.msisdn.replace(/[^0-9\d]/gi,"")}),a.value.email&&Object.assign(o,{email:a.value.email}),a.value.successfulSending=!!await u(U,o)}async function O(){a.value.successfulSending=!!await u(U,{email:a.value.email})}return(o,e)=>{var p,f,h,y,k,T,V,$;const c=x("i18n-t");return i(),n(N,null,[(i(),M(ee,{to:"body"},[g.value?(i(),M(ce,{key:0},{default:I(()=>[D(he,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=v=>g.value=v),onAccept:L},null,8,["modelValue"])]),_:1})):d("",!0)])),a.value.successfulSending?!((T=(k=A.data)==null?void 0:k.options)!=null&&T.customerReceiptAreaEnabled)&&(($=(V=A.data)==null?void 0:V.merchant)==null?void 0:$.emailReceiptEnabled)?(i(),n("div",Ce,[l("div",Ie,r(o.$t("receiptArea.successSendEmail")),1)])):(i(),n("div",De,[l("img",{src:s(de),class:"receiptResult__img",alt:"img-success"},null,8,we),l("div",Ue,r(o.$t("receiptArea.finish_title")),1)])):(i(),n("div",ye,[((f=(p=A.data)==null?void 0:p.options)==null?void 0:f.customerReceiptAreaEnabled)&&!((y=(h=A.data)==null?void 0:h.options)!=null&&y.customerEmail)?(i(),M(H,{key:0,modelValue:a.value.agree_get_receipt,"onUpdate:modelValue":e[2]||(e[2]=v=>a.value.agree_get_receipt=v),name:"customer.agree_get_receipt",class:"receiptArea__get-receipt",rules:"required"},{default:I(()=>[D(c,{keypath:"receiptArea.agree_get_receipt",tag:"label",for:"customer.agree_get_receipt",scope:"global"},{default:I(()=>[l("span",{class:"terms",onClick:e[1]||(e[1]=Y(v=>a.value.agree_get_receipt=!a.value.agree_get_receipt,["prevent"]))},r(o.$t("receiptArea.agree_get_receipt")),1)]),_:1})]),_:1},8,["modelValue"])):d("",!0),D(te,{appear:"",name:"smooth",mode:"in-out"},{default:I(()=>{var v,R;return[((R=(v=A.data)==null?void 0:v.options)==null?void 0:R.customerReceiptAreaEnabled)&&a.value.agree_get_receipt?(i(),M(s(z),{key:0,class:"receiptArea__form",onSubmit:_},{default:I(({isSubmitting:B,errors:E})=>[l("div",ke,r(o.$t("receiptArea.titleText")),1),l("div",$e,[D(K,{modelValue:a.value.email,"onUpdate:modelValue":e[3]||(e[3]=C=>a.value.email=C),name:"email",type:"email",class:w(["clear-icon-visible",{"none-empty-input":a.value.email,invalid:E.email}]),rules:{required:!a.value.msisdn,email:!0},label:o.$t("receiptArea.emailTitle"),error:E},null,8,["modelValue","class","rules","label","error"])]),D(H,{ref_key:"checkboxRef",ref:m,modelValue:a.value.agree_data_processing,"onUpdate:modelValue":e[5]||(e[5]=C=>a.value.agree_data_processing=C),name:"customer.agree_data_processing",class:"receiptArea__processing",rules:{required:!a.value.agree_data_processing},error:E,checked:""},{default:I(()=>[D(c,{keypath:"receiptArea.agree_data_processing",tag:"label",for:"customer.agree_data_processing",scope:"global"},{default:I(()=>[l("span",{class:"terms",onClick:e[4]||(e[4]=Y(C=>g.value=!0,["prevent"]))},r(o.$t("receiptArea.agree_data_processing_word")),1)]),_:1})]),_:2},1032,["modelValue","rules","error"]),D(H,{modelValue:a.value.agree_advertising,"onUpdate:modelValue":e[6]||(e[6]=C=>a.value.agree_advertising=C),name:"customer.agree_advertising",class:"receiptArea__advertising",error:E,label:o.$t("receiptArea.agree_advertising"),checked:""},null,8,["modelValue","error","label"]),A.data.state==="result"?(i(),n("div",Ae,[l("button",{id:"submitBtn",disabled:B||Object.keys(E).length||s(S),class:"btn btn-primary",type:"submit"},r(o.$t("receiptArea.btn_send_receipt")),9,Se)])):d("",!0)]),_:1})):d("",!0)]}),_:1}),s(b)?(i(),M(s(z),{key:1,class:w(["receiptArea__form",{open:a.value.agree_get_receipt}]),onSubmit:O},{default:I(({isSubmitting:v,errors:R})=>[l("div",Te,r(o.$t("receiptArea.emailFormTitle")),1),l("div",Ve,[D(K,{modelValue:a.value.email,"onUpdate:modelValue":e[7]||(e[7]=B=>a.value.email=B),name:"email",type:"email",class:w(["clear-icon-visible",{"none-empty-input":a.value.email,invalid:R.email}]),rules:{required:!0,email:!0},label:o.$t("receiptArea.emailTitle"),error:R},null,8,["modelValue","class","label","error"])]),A.data.state==="result"?(i(),n("div",Re,[a.value.successfulSending?d("",!0):(i(),n("button",{key:0,disabled:v,class:"btn btn-primary"},r(o.$t("receiptArea.btn_send_email_receipt")),9,Ee))])):d("",!0)]),_:1},8,["class"])):d("",!0)]))],64)}}},Me={key:0,class:"content-wrapper bill"},Pe=l("div",{class:"bill-form__header-icon"},null,-1),Fe={key:0,class:"bill-form__header-amount"},je={key:1,class:"bill-form__header-amount"},qe={class:"bill-form__header-title"},Le={key:2,class:"bill-form__header-unknown"},Ne={key:3,class:"bill-form__header-description"},Oe=["innerHTML"],Ge={class:"bill-form__main"},He={class:"value"},We={key:0,class:"gpb_banner__container"},Ye=["href"],ze=["src"],Je={class:"bill-form__btns"},Ke=["href"],Qe=l("img",{class:"angle-right",src:Z},null,-1),st={setup(A){const{paymentState:t,getPaymentStateResultStatus:j}=se(),{globalLoaderHide:U}=ne(),a=F(null),{t:u}=Q(),g=F(null),{redirectTimeout:m}=window.settings,S=X(),b={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"},L=P(()=>{var e,c,p,f,h,y,k,T,V,$,v,R,B,E;return[{title:u("pages.result.table.merchant"),value:G.urlToStringWithoutProtocol((c=(e=t.value)==null?void 0:e.merchant)==null?void 0:c.url)},{title:u("pages.result.table.description"),value:(p=t.value)==null?void 0:p.description},{title:u("pages.result.table.pan"),value:(h=(f=t.value)==null?void 0:f.src)==null?void 0:h.pan},{title:u("pages.result.table.pan"),value:(k=(y=t.value)==null?void 0:y.dst)==null?void 0:k.pan},{title:u("pages.result.table.date"),value:new Date((T=t.value)==null?void 0:T.finishedAt).toLocaleString("ru",b)},{title:u("pages.result.table.rrn"),value:(V=t.value)==null?void 0:V.result.rrn},{title:u("pages.result.table.approvalCode"),value:($=t.value)==null?void 0:$.result.approvalCode},{title:u("pages.result.table.trxId"),value:(v=t.value)==null?void 0:v.result.trxId,class:"trxId"},{title:u(`pages.result.table.externalTrxId.${(B=(R=t.value)==null?void 0:R.src)==null?void 0:B.type}`),value:(E=t.value)==null?void 0:E.result.externalTrxId}].filter(C=>C.value)}),_=P(()=>{var e,c;return j((e=t.value)==null?void 0:e.result,(c=t.value)==null?void 0:c.paymentId)}),O=P(()=>{var e,c;return(t.value.result.status===q.SUCCESS||t.value.result.status===q.INTERIM_SUCCESS)&&t.value.result.orderStatus!==q.REGISTERED&&((c=(e=t.value.options)==null?void 0:e.bannerData)==null?void 0:c.bannerImageUrl)}),o=P(()=>{var f,h,y,k;const e=((f=t.value)==null?void 0:f.paymentId)===J.OCT||((h=t.value)==null?void 0:h.paymentId)===J.AFT,c=((k=(y=t.value)==null?void 0:y.result)==null?void 0:k.orderStatus)===q.REGISTERED;return u(e?"tabTitle.bill.transfer":c?"tabTitle.bill.registration":"tabTitle.bill.pay")});return le(S,()=>document.title=o.value),ie(()=>{var e;m&&setTimeout(()=>a.value.click(),m*1e3),ue(t),(e=t.value)!=null&&e.result.status&&U(),document.title=o.value}),(e,c)=>{var p,f,h,y,k,T,V;return s(t)?(i(),n("div",Me,[l("div",{class:w(["bill-form",s(_).class])},[l("div",{class:w(["bill-form__header",s(_).class])},[Pe,s(_).class==="success"&&((f=(p=s(t))==null?void 0:p.descriptionParams)==null?void 0:f.amountWithAcquirerCommission)?(i(),n("div",Fe,r(s(G).formatCurrency(s(t).descriptionParams.amountWithAcquirerCommission,s(t).currency)),1)):s(_).class==="success"&&((h=s(t))==null?void 0:h.amount)?(i(),n("div",je,r(s(G).formatCurrency(s(t).amount,s(t).currency)),1)):d("",!0),l("div",qe,r(e.$t(s(_).title)),1),s(_).unknown?(i(),n("div",Le,r(e.$t("pages.result.status.unknown")),1)):d("",!0),s(_).description?(i(),n("div",Ne,r(e.$t(s(_).description)),1)):d("",!0),s(_).offline?(i(),n("div",{key:4,class:"bill-form__header-offline",innerHTML:e.$t(s(_).message)},null,8,Oe)):d("",!0)],2),l("div",Ge,[l("div",{class:w(["bill-form__main-transaction",{open:g.value}])},[(i(!0),n(N,null,W(s(L),$=>(i(),n("div",{key:$.value,class:"bill-form__main-transaction-item"},[l("div",{class:w(["title",$.class])},r($.title),3),l("div",He,r($.value),1)]))),128))],2),s(t).result.orderStatus!==s(q).REGISTERED&&s(L).length>3?(i(),n("div",{key:0,class:w(["bill-form__main-readMore",{isVisibleDetail:g.value}]),onClick:c[0]||(c[0]=$=>g.value=!g.value)},r(e.$t("pages.result.readMore")),3)):d("",!0)]),s(_).class==="success"?(i(),M(Be,{key:0,data:s(t)},null,8,["data"])):d("",!0)],2),s(O)?(i(),n("div",We,[l("a",{class:"gpb__banner",target:"_blank",href:(k=(y=s(t).options)==null?void 0:y.bannerData)==null?void 0:k.bannerRedirectUrl},[l("img",{src:(V=(T=s(t).options)==null?void 0:T.bannerData)==null?void 0:V.bannerImageUrl,alt:"banner"},null,8,ze)],8,Ye)])):d("",!0),l("div",Je,[l("a",{id:"submitBtn",ref_key:"returnToShopBtn",ref:a,href:s(_).backUrl,class:"btn back-to-merchant"},[re(r(e.$t("ui.btn.goToMerchant"))+" ",1),Qe],8,Ke)])])):d("",!0)}}};export{st as default};
