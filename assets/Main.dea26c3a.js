import{c as N,r as K,w as L,o as i,a as I,u as e,n as f,b as U,d as h,S as me,e as G,f as w,p as z,A as H,g as Ee,F as Ie,h as S,i as t,t as C,j as ee,T as ye,k as W,l as Me,m as Ve,q as ve,s as _e,v as D,x as ge,y as De,z as Ne,B as xe,C as Oe,D as Be,E as qe,G as pe,H as Le,I as Ue,J as de,K as Fe,L as ze,P as M,M as Ge,N as Z,O as je}from"./gpb-new.9481ec94.js";import{u as Ye,_ as He,a as Ke,b as We,D as Xe,M as Je,c as Qe,d as Ze,V as et,U as tt}from"./FormHeader.8e911390.js";import{_ as at}from"./angle-right_blue.3c01ebe8.js";import{u as he}from"./useLoader.013ecf08.js";import{_ as Pe,o as nt,D as ot,a as st}from"./Dialog.55d98c8a.js";import{_ as j}from"./plugin-vue_export-helper.21dcd24c.js";import it from"./Loader.031c810a.js";var lt="assets/question.47741165.svg";const rt={props:{errors:{type:Object,default:{}},minPanLength:{type:Number}},setup(d){const n=d,l=N(()=>({required:!0,pan:[{minPanLength:n.minPanLength}]}));return(m,a)=>{const y=K("maska");return L((i(),I(Pe,{name:"pan",rules:e(l),type:"tel",label:m.$t("ui.input.pan.label"),class:f({invalid:n.errors.pan})},null,8,["rules","label","class"])),[[y,"#### #### #### #### ###"]])}}},ct={props:{data:Object,type:String,isCombined:{type:Boolean,default:!1},errors:{type:Object,default:{}}},setup(d){const n=d,l=N(()=>{var m,a;return{required:!0,[n.type]:[{isExpiredCardsAllowed:!!((a=(m=n.data)==null?void 0:m.options)!=null&&a.expiredCardsAllowed),isCombined:n.isCombined}]}});return(m,a)=>{const y=K("maska");return L((i(),I(Pe,{type:"tel",name:d.type,class:f({invalid:n.errors[n.type]}),rules:e(l),label:m.$t(`ui.input.${n.type}.label`)},null,8,["name","class","rules","label"])),[[y,"##"]])}}};const pt={props:{data:Object},setup(d){const{fastPaymentMethod:n}=U();return(l,m)=>(i(),h("button",{class:"gpp-button btn",onClick:m[0]||(m[0]=a=>{var y,_;return e(n)(e(me).gazprom_pay,(_=(y=d.data)==null?void 0:y.options)==null?void 0:_.customerReceiptAreaEnabled)})}))}};var dt=j(pt,[["__scopeId","data-v-2f243c61"]]);const ue={props:{data:Object},setup(d){const n=d,{initPayment:l,checkPaymentState:m}=U(),{startGooglePayment:a}=z(),{globalLoaderShow:y}=he(),_=G().hash.slice(1),{googlePay:P}=window.settings,T="TEST";let u=new google.payments.api.PaymentsClient({environment:P.googlePayEnvironment||T});const r={isPaymentRequest:!1,googlePayClient:u};let s=V();window.PaymentRequest&&(r.isPaymentRequest=!0,u.isReadyToPay(s).then(function(o){o.result?(u.createButton({buttonColor:"white",buttonType:"short",onClick:k}),x(n.data)):console.log("Google Pay is not available")}).catch(function(o){console.error(o)}));function V(){var o=["PAN_ONLY","CRYPTOGRAM_3DS"],v=["MASTERCARD","VISA"];return{apiVersion:2,apiVersionMinor:0,allowedPaymentMethods:[{type:"CARD",parameters:{allowedAuthMethods:P.googlePayAllowedCardAuthMethods||o,allowedCardNetworks:P.googlePayAllowedCardNetworks||v}}]}}function A(o){let v=Object.assign({},V()),O=P.googlePayRequestType||"PAYMENT_GATEWAY";return v.allowedPaymentMethods[0].tokenizationSpecification={type:O},O=="DIRECT"?(v.allowedPaymentMethods[0].tokenizationSpecification={parameters:{protocolVersion:"ECv2",publicKey:o.options.googlePayMerchantPublicKey}},v.merchantInfo={merchantId:o.options.googlePayMerchantId}):v.allowedPaymentMethods[0].tokenizationSpecification.parameters={gateway:o.options.googlePayGatewayId,gatewayMerchantId:o.options.googlePayGatewayMerchantId},v.merchantInfo={merchantName:o.options.googlePayMerchantName,merchantOrigin:o.options.googlePayMerchantOrigin,merchantId:o.options.googlePayGatewayMerchantId},v.transactionInfo={countryCode:"RU",currencyCode:o.currency,totalPriceStatus:"FINAL",totalPrice:(o.amount/100).toFixed(2).toString()},v}function x(o){var v=A(o);v.transactionInfo={totalPriceStatus:"NOT_CURRENTLY_KNOWN",currencyCode:o.currency},r.googlePayClient.prefetchPaymentData(v)}function k(){let o=A(n.data);r.googlePayClient.loadPaymentData(o).then(function(v){let O=v.paymentMethodData.tokenizationData.token;y(),a(_,O).then(X=>m(X,_)).catch(()=>l())}).catch(function(v){console.error(v)})}return(o,v)=>r.isPaymentRequest?(i(),h("button",{key:0,type:"button","aria-label":"Google Pay",class:"btn gpay-button black short en",onClick:k})):w("",!0)}};const ut={props:{data:Object},setup(d){const n=G().hash.slice(1),{initPayment:l,checkPaymentState:m}=U(),{getApplePaySession:a,startApplePayPayment:y}=z(),P=ApplePaySession.supportsVersion(H.eleven)?H.eleven:H.one;function T(u,r,s){var V={countryCode:"RU",currencyCode:r.currency,total:{label:r.merchant.name,amount:Ie.amountMinorToAmount(r.amount)},supportedNetworks:["masterCard","visa"],merchantCapabilities:["supports3DS"]};s===H.eleven&&V.supportedNetworks.push("mir");const A=new ApplePaySession(s,V);u.applePaySession=A,A.onvalidatemerchant=function(x){const k=x.validationURL;u.appleValidationRes?A.completeMerchantValidation(u.appleValidationRes):a(n,k).then(o=>{o.epochTimestamp=Number(o.epochTimestamp),o.expiresAt=Number(o.expiresAt),u.appleValidationRes=o,A.completeMerchantValidation(o)}).catch(()=>l())},A.onpaymentauthorized=function(x){const k=x.payment;k.token&&k.token.paymentMethod&&!k.token.paymentMethod.type&&(k.token.paymentMethod.type="unknown"),y(n,k).then(o=>m(o,n)).catch(()=>l())},A.begin()}return(u,r)=>{const s=Ee("apple-pay-button");return i(),I(s,{buttonstyle:"black",type:"plain",locale:"en-US",class:"apple-pay-button btn",onClick:r[0]||(r[0]=V=>T({},d.data,e(P)))})}}};var mt=j(ut,[["__scopeId","data-v-3d0120f9"]]),yt="assets/mir_pay.bae7ec04.svg",vt="assets/mir_pay_form.3f8b3bd8.svg";const _t=d=>(Me("data-v-306556e8"),d=d(),Ve(),d),gt={key:0,class:"modalMir"},ht={class:"mirForm"},Pt=_t(()=>t("div",{class:"loaderMir"},[t("div",{class:"lds-ellipsis"},[t("div"),t("div"),t("div"),t("div")])],-1)),bt={class:"mirForm-top-text"},ft=["src"],kt={class:"mirForm-text"},wt={href:"https://play.google.com/store/apps/details?id=ru.nspk.mirpay"},Ct=["src"],Tt={props:{data:Object},setup(d){const n=d,l=G(),m=S(!1),{startMirPayPayment:a}=z(),{checkPaymentState:y}=U();let _=l.hash.slice(1);async function P(){location.href=l.query.back_url_f}async function T(){window.location.href=n.data.options.mirPayLink,m.value=!0;const u=await a(_);y(u,_)}return(u,r)=>(i(),h(W,null,[(i(),I(ye,{to:"body"},[m.value?(i(),h("div",gt,[t("div",ht,[Pt,t("div",bt,C(u.$t("pages.main.mirPay.mirPayTopText")),1),t("img",{src:e(vt),class:"mirForm-logo"},null,8,ft),t("div",kt,[ee(C(u.$t("pages.main.mirPay.mirPayTextStart"))+" ",1),t("a",wt,C(u.$t("pages.main.mirPay.mirPayUrl")),1),ee(" "+C(u.$t("pages.main.mirPay.mirPayTextEnd")),1)]),t("a",{class:"mirForm-btn",onClick:P},C(u.$t("pages.main.mirPay.mirPayBtn")),1)])])):w("",!0)])),t("button",{class:"mir-button btn",onClick:T},[t("img",{src:e(yt),alt:""},null,8,Ct)])],64))}};var At=j(Tt,[["__scopeId","data-v-306556e8"]]);const Rt={props:{data:Object},setup(d){const{fastPaymentMethod:n}=U(),{globalLoaderShow:l}=ve();return(m,a)=>(i(),h("button",{class:"btn sbp-button",onClick:a[0]||(a[0]=y=>{var _,P;return e(n)("sbp",(P=(_=d.data)==null?void 0:_.options)==null?void 0:P.customerReceiptAreaEnabled,e(l))})}))}};var St=j(Rt,[["__scopeId","data-v-7144b588"]]),$t="assets/angle-down-black.d4c0b535.svg";const be={props:{modelValue:{type:Boolean,required:!0}},setup(d){return(n,l)=>(i(),h("img",{class:f(["angle-down",{open:d.modelValue}]),src:$t,onClick:l[0]||(l[0]=_e(m=>n.$emit("update:modelValue",!d.modelValue),["stop"]))},null,2))}};const Et={class:"sbp-title"},It={class:"paymentButtons"},Mt={props:{data:Object},setup(d){const n=d,l=[],{googlePay:m}=window.settings,a=G().query.gpay||m.gpay,y=S(!1),{isToggleButtonEnabled:_,mirPayDesktopShow:P}=window.settings;if(a&&window.PaymentRequest&&n.data.options&&(n.data.options.googlePayMerchantPublicKey||m.googlePayRequestType!="DIRECT"&&n.data.options.googlePayGatewayId)&&l.push(ue),window.ApplePaySession&&n.data.options.applePayMerchantIdentifier){let T=n.data.options.applePayMerchantIdentifier;window.ApplePaySession.canMakePaymentsWithActiveCard(T).then(function(r){r&&l.push(mt)})}return n.data.options&&n.data.options.sbpEnabled&&l.push(St),n.data.options&&n.data.options.mirPayLink&&(/Android/i.test(navigator.userAgent)||P)&&l.push(At),(T,u)=>l.length?(i(),h("div",{key:0,class:f({"toggleable-content":e(_)&&!y.value,"toggleable-content visible":e(_)&&y.value})},[e(_)?(i(),h("div",{key:0,class:"sbp-title-container",onClick:u[1]||(u[1]=r=>y.value=!y.value)},[t("h4",Et,C(T.$t("pages.main.sbpTitle")),1),D(be,{modelValue:y.value,"onUpdate:modelValue":u[0]||(u[0]=r=>y.value=r)},null,8,["modelValue"])])):w("",!0),t("div",It,[(i(),h(W,null,ge(l,r=>t("div",{key:r,class:"paymentButtons_item"},[(i(),I(De(r),{data:d.data,class:f({"white long":r===ue})},null,8,["data","class"]))])),64))])],2)):w("",!0)}};var Vt=j(Mt,[["__scopeId","data-v-7266d1a6"]]);const Dt=t("div",{id:"acs"},null,-1),Nt={key:1,class:"content-wrapper"},xt={key:1,class:"gaz-prom-pay"},Ot={class:"gaz-prom-pay__description-container"},Bt={class:"gaz-prom-pay__description"},qt={class:"help-tooltip__title"},Lt={class:"help-tooltip__description"},Ut={class:"pay-title"},Ft={class:"icons-container"},zt={key:0,class:"card-brand"},Gt=["src"],jt=t("div",{class:"cvc-logo"},[t("img",{src:We,alt:"CVC"})],-1),Yt={key:1,class:"checkbox-container"},Ht={class:"pay-btn-container"},Kt=["disabled"],Wt={class:"back-to-merchant-container"},Xt=t("img",{class:"angle-right",src:at},null,-1),oa={setup(d){const{initPayment:n,checkRegistrationToken:l,checkPaymentState:m,paymentState:a,replaceRoute:y,requestPaymentState:_}=U(),{start:P,accept:T,decline:u}=z(),r=G(),{card:s,getSrcCardParams:V,getDstCardParams:A,getCardParams:x}=Ye(),k=S(!1),o=S(!1),{localeLoaderShow:v,globalLoaderShow:O,hideLoaders:X}=he(o),te=S(!1),{iframeHandler:fe,apiErrorHandlerOn:ae,apiErrorHandlerOff:ne}=Ne(),{requestProcessing:oe}=ve(),{cardRegistrationPage:$}=window.settings,ke=S(!1),we=S(!1),Ce=S(!1),F=S(!1),se=S(null),B=S(!1),{isToggleButtonEnabled:J}=window.settings,{t:ie}=xe(),{setTabTitle:le}=Oe(),Q=N(()=>{var c,p,R;return((c=a.value)==null?void 0:c.paymentId)!==M.AFT&&((p=a.value)==null?void 0:p.paymentId)!==M.OCT&&((R=a.value)==null?void 0:R.paymentId)!==M.TRANSP_DEBT&&!$}),re=N(()=>s.pan?Ge(s.pan,{MIR:Je,MASTERCARD:Qe,MAESTRO:Ze,VISA:et,UPI:tt},Xe):""),Te=N(()=>{let c=!0;return(a.value.paymentId===M.OCT&&s.pan||s.pan&&s.pan.length>Z.PAN&&s.cvc&&s.cvc.length>Z.CVC&&s.expiry&&s.expiry.length>Z.EXPIRY)&&(c=!1),c}),Ae=N(()=>a.value.paymentId!==M.OCT),Re=N(()=>{var c;return(!a.value.paymentId||a.value.paymentId===M.TRANSP_DEBT)&&((c=a.value.src)==null?void 0:c.addToProfileEnabled)}),ce=N(()=>$?"continue":a.value.paymentId===M.OCT?"transferToCard":a.value.paymentId===M.AFT?"transferToAccount":"pay");nt(se,()=>{F.value=!1});async function Se(c,p){var b;oe();let R=r.hash.slice(1),q,E;$?E=x(s):a.value.paymentId===M.OCT&&!$?(v(),E=A(s.pan)):E=V(s),(b=a.value.options)!=null&&b.customerReceiptAreaEnabled&&Object.assign(E,{"customer.receiptUrl":location.origin+"/"+window.location.hash});const Y=async g=>{g.error===je.UNEXPECTED_REQUEST?await _():p.setFieldError("pan",ie(`errors.api.${g.error}`))};if(ne(),ae(Y),$){const{token:g}=await z().token();R=g,await y(R),E.returnUrl=window.location.href,q=await P(R,E)}else q=await T(R,E);v(),k.value=!0,await m(q,R)}async function $e(){oe();const c=r.hash.slice(1);try{await u(c)}catch(p){console.log(p)}finally{location.href=r.query.back_url_f}}return Be(r,c=>{c.query["src.type"]===me.gazprom_pay&&c.name==="main"?document.title=ie("tabTitle.processing"):le()}),qe(async()=>{var c,p;window.frameElement?console.log("frame"):(fe(te),ae(),O(),$?await l():await n(),((c=a.value)==null?void 0:c.state)!==pe.REDIRECT&&((p=a.value)==null?void 0:p.state)!==pe.RESULT&&(X(),le()))}),Le(()=>{ne()}),(c,p)=>{var E;const R=K("maska"),q=K("focus-next");return i(),h(W,null,[(i(),I(ye,{to:"body"},[L(D(ot,null,{default:de(()=>[Dt]),_:1},512),[[Ue,te.value]])])),o.value?(i(),I(it,{key:0})):w("",!0),e(a)&&!k.value&&!o.value?(i(),h("div",Nt,[e($)?w("",!0):(i(),I(He,{key:0,data:e(a)},null,8,["data"])),((E=e(a).options)==null?void 0:E.gazpromPayEnabled)&&!e($)?(i(),h("div",xt,[t("div",Ot,[t("p",Bt,C(c.$t("pages.main.gazpromPay")),1),t("img",{class:f(["help-icon",{disable:F.value}]),src:lt,onClick:p[0]||(p[0]=Y=>F.value=!F.value)},null,2),t("div",{ref_key:"tooltipRef",ref:se,class:f(["help-tooltip",{visible:F.value}])},[t("h4",qt,C(c.$t("pages.main.helpTooltip.title")),1),t("p",Lt,C(c.$t("pages.main.helpTooltip.description")),1)],2)]),D(dt,{data:e(a)},null,8,["data"])])):w("",!0),D(e(ze),{onSubmit:Se,onKeydown:p[7]||(p[7]=Fe(_e(()=>{},["prevent"]),["enter"]))},{default:de(({isSubmitting:Y,errors:b})=>[t("div",{class:f(["main-form",{"toggleable-content":e(J)&&!B.value&&e(Q),"toggleable-content visible":e(J)&&B.value&&e(Q)}])},[t("div",{class:"pay-title-container",onClick:p[2]||(p[2]=g=>B.value=!B.value)},[t("h4",Ut,C(c.$t(`pages.main.payTitle.${e(ce)}`)),1),e(J)&&e(Q)?(i(),I(be,{key:0,modelValue:B.value,"onUpdate:modelValue":p[1]||(p[1]=g=>B.value=g)},null,8,["modelValue"])):w("",!0)]),t("div",{class:f(["pan-input-container",{invalid:b.pan,active:ke.value&&!b.pan}])},[L(D(rt,{modelValue:e(s).pan,"onUpdate:modelValue":p[3]||(p[3]=g=>e(s).pan=g),class:f(["clear-icon-visible",{"none-empty-input":e(s).pan}]),errors:b},null,8,["modelValue","class","errors"]),[[R,["####","#### ####","#### #### ####","#### #### #### ####","#### #### #### #### ###"]]]),t("div",Ft,[e(re).length?(i(),h("div",zt,[(i(!0),h(W,null,ge(e(re),g=>(i(),h("img",{key:g,src:g,alt:"Brand"},null,8,Gt))),128))])):w("",!0)])],2),e(Ae)?(i(),h("div",{key:0,class:f(["expiry-cvc-input-container",{invalid:b.expiry||b.cvc}])},[t("div",{class:f(["expiry-input-group",{invalid:b.expiry,active:we.value&&!b.expiry}])},[L(D(ct,{modelValue:e(s).expiry,"onUpdate:modelValue":p[4]||(p[4]=g=>e(s).expiry=g),data:e(a),class:f({"none-empty-input":e(s).expiry}),type:"expiry","is-Combined":"",errors:b},null,8,["modelValue","data","class","errors"]),[[q,{length:7,target:"cvc"}],[R,"## / ##"]])],2),t("div",{class:f(["cvc-input-group",{invalid:b.cvc,active:Ce.value&&!b.cvc}])},[L(D(Ke,{modelValue:e(s).cvc,"onUpdate:modelValue":p[5]||(p[5]=g=>e(s).cvc=g),class:f({"none-empty-input":e(s).cvc}),errors:b},null,8,["modelValue","class","errors"]),[[q,{length:3,target:"addToProfile"}]]),jt],2)],2)):w("",!0),e(Re)&&!e($)?(i(),h("div",Yt,[D(st,{modelValue:e(s).save,"onUpdate:modelValue":p[6]||(p[6]=g=>e(s).save=g),name:"addToProfile",class:"addToProfile",label:c.$t("ui.input.saveCard.label")},null,8,["modelValue","label"])])):w("",!0),t("div",Ht,[t("button",{id:"submitBtn",disabled:Y||Object.keys(b).length||e(Te),class:"btn btn-primary"},C(c.$t(`ui.btn.${e(ce)}`)),9,Kt)])],2)]),_:1}),e($)?w("",!0):(i(),I(Vt,{key:2,data:e(a)},null,8,["data"])),t("div",Wt,[t("button",{class:"btn back-to-merchant",onClick:$e},[ee(C(c.$t("ui.btn.goToMerchant"))+" ",1),Xt])])])):w("",!0)],64)}}};export{oa as default};
